name: 🚀 Umitmod IPTV Güncelleyici
on:
  schedule:
    - cron: "0 */3 * * *"  # Her 3 saatte bir (CRON syntax)
  workflow_dispatch:       # Manuel tetikleme

jobs:
  build-and-update:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # Push işlemi için izin

    steps:
      - name: 🛠️ Repoyu Klonla
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Tüm commit geçmişi

      - name: 🐍 Python Kurulumu
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"  # Sabit versiyon önerilir

      - name: 📦 Bağımlılıkları Kur
        run: |
          pip install httpx==0.27.0  # Versiyon sabitleme
          pip install requests  # Opsiyonel

      - name: 🏃‍♂️ Scripti Çalıştır
        run: |
          python ugur.py || exit 1
        env:
          DISABLE_SSL_VERIFY: "True"  # SSL hatası için

      - name: 🔍 Çıktıyı Kontrol Et
        run: |
          if [ ! -f "Umitmod.m3u" ]; then
            echo "❌ Hata: M3U dosyası oluşmadı!"
            exit 1
          fi
          echo "✔️ Dosya başarıyla oluşturuldu."

      - name: 📌 Değişiklikleri GitHub'a Gönder
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add Umitmod.m3u
          git commit -m "🔧 Otomatik güncelleme: $(date '+%d.%m.%Y %H:%M')" || echo "🔄 Değişiklik yok."
          git push
